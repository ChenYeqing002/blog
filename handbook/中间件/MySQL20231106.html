<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2023/11/06 | 陈烨庆的博客</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="陈烨庆的博客">
    
    <link rel="preload" href="/blog/assets/css/0.styles.93dbc0ad.css" as="style"><link rel="preload" href="/blog/assets/js/app.72825979.js" as="script"><link rel="preload" href="/blog/assets/js/7.8588c638.js" as="script"><link rel="preload" href="/blog/assets/js/2.41cf65d9.js" as="script"><link rel="preload" href="/blog/assets/js/1.934c718e.js" as="script"><link rel="preload" href="/blog/assets/js/48.fbf85be5.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.323e1776.js"><link rel="prefetch" href="/blog/assets/js/11.2e249cd3.js"><link rel="prefetch" href="/blog/assets/js/14.97f484df.js"><link rel="prefetch" href="/blog/assets/js/15.eb4019ba.js"><link rel="prefetch" href="/blog/assets/js/16.4404ea41.js"><link rel="prefetch" href="/blog/assets/js/17.ffaa0f8d.js"><link rel="prefetch" href="/blog/assets/js/18.712bc68c.js"><link rel="prefetch" href="/blog/assets/js/19.84577435.js"><link rel="prefetch" href="/blog/assets/js/20.faee171e.js"><link rel="prefetch" href="/blog/assets/js/21.12df311a.js"><link rel="prefetch" href="/blog/assets/js/22.dde20332.js"><link rel="prefetch" href="/blog/assets/js/23.e9aacf79.js"><link rel="prefetch" href="/blog/assets/js/24.76d381ff.js"><link rel="prefetch" href="/blog/assets/js/25.e6f7cff1.js"><link rel="prefetch" href="/blog/assets/js/26.4b866aeb.js"><link rel="prefetch" href="/blog/assets/js/27.3068f796.js"><link rel="prefetch" href="/blog/assets/js/28.31207501.js"><link rel="prefetch" href="/blog/assets/js/29.d837276f.js"><link rel="prefetch" href="/blog/assets/js/3.cdac5c83.js"><link rel="prefetch" href="/blog/assets/js/30.2b34bc2d.js"><link rel="prefetch" href="/blog/assets/js/31.4c2e3072.js"><link rel="prefetch" href="/blog/assets/js/32.5f5ff60a.js"><link rel="prefetch" href="/blog/assets/js/33.df15770d.js"><link rel="prefetch" href="/blog/assets/js/34.2a7572c8.js"><link rel="prefetch" href="/blog/assets/js/35.a53ffaf7.js"><link rel="prefetch" href="/blog/assets/js/36.6f990377.js"><link rel="prefetch" href="/blog/assets/js/37.d1889e3b.js"><link rel="prefetch" href="/blog/assets/js/38.8ac342a8.js"><link rel="prefetch" href="/blog/assets/js/39.1fbeb74d.js"><link rel="prefetch" href="/blog/assets/js/4.8ace6b48.js"><link rel="prefetch" href="/blog/assets/js/40.398dbc64.js"><link rel="prefetch" href="/blog/assets/js/41.95db8b32.js"><link rel="prefetch" href="/blog/assets/js/42.69320e3b.js"><link rel="prefetch" href="/blog/assets/js/43.0752c22f.js"><link rel="prefetch" href="/blog/assets/js/44.099c540f.js"><link rel="prefetch" href="/blog/assets/js/45.49fb1d78.js"><link rel="prefetch" href="/blog/assets/js/46.49ef371d.js"><link rel="prefetch" href="/blog/assets/js/47.9848b504.js"><link rel="prefetch" href="/blog/assets/js/49.8210487d.js"><link rel="prefetch" href="/blog/assets/js/5.f6ae86c1.js"><link rel="prefetch" href="/blog/assets/js/50.2891ab22.js"><link rel="prefetch" href="/blog/assets/js/51.bc1ed377.js"><link rel="prefetch" href="/blog/assets/js/52.1c71c6ef.js"><link rel="prefetch" href="/blog/assets/js/53.d3cdaf4a.js"><link rel="prefetch" href="/blog/assets/js/54.419f63d5.js"><link rel="prefetch" href="/blog/assets/js/55.940f31a7.js"><link rel="prefetch" href="/blog/assets/js/6.934dda82.js"><link rel="prefetch" href="/blog/assets/js/8.c40fe45c.js"><link rel="prefetch" href="/blog/assets/js/9.2e2433d3.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.f40f3d0b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.93dbc0ad.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>陈烨庆的博客</h3> <p class="description" data-v-59e6cb88>陈烨庆的博客</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">陈烨庆的博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      陈烨庆的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/chenyeqing" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>15</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      陈烨庆的博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/chenyeqing" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/" class="sidebar-heading clickable router-link-active"><span>JAVA</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/JAVA/231111锁.html" class="sidebar-link">231111锁</a></li><li><a href="/blog/handbook/JAVA/JVM基础.html" class="sidebar-link">JVM基础</a></li><li><a href="/blog/handbook/JAVA/JVM探究.html" class="sidebar-link">JVM探究</a></li><li><a href="/blog/handbook/JAVA/多线程.html" class="sidebar-link">多线程</a></li><li><a href="/blog/handbook/JAVA/集合源码.html" class="sidebar-link">集合源码</a></li><li><a href="/blog/handbook/JAVA/垃圾回收(回收对象).html" class="sidebar-link">垃圾回收(回收对象)</a></li><li><a href="/blog/handbook/JAVA/切换日志记录.html" class="sidebar-link">切换日志记录</a></li><li><a href="/blog/handbook/JAVA/三级缓存.html" class="sidebar-link">三级缓存</a></li><li><a href="/blog/handbook/JAVA/@SentinelResource不生效的问题.html" class="sidebar-link">@SentinelResource不生效的问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/中间件/" class="sidebar-heading clickable open"><span>中间件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/中间件/MySQL20231106.html" class="active sidebar-link">MySQL20231106</a></li><li><a href="/blog/handbook/中间件/Nacos.html" class="sidebar-link">Nacos</a></li><li><a href="/blog/handbook/中间件/MySQL调优.html" class="sidebar-link">MySQL调优</a></li><li><a href="/blog/handbook/中间件/RabbitMQ.html" class="sidebar-link">RabbitMQ</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/面试/" class="sidebar-heading clickable"><span>面试</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/面试/面试.html" class="sidebar-link">面试</a></li><li><a href="/blog/handbook/面试/面试2.0.html" class="sidebar-link">面试2.0</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/电脑问题/" class="sidebar-heading clickable"><span>电脑问题</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/电脑问题/在Win11桌面右键直接创建md文件.html" class="sidebar-link">在Win11桌面右键直接创建md文件</a></li><li><a href="/blog/handbook/电脑问题/优化机器调整DPC.html" class="sidebar-link">优化机器调整DPC</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">2023/11/06</h1> <div data-v-8a445198><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h3 id="_2023-11-06"><a href="#_2023-11-06" class="header-anchor">#</a> 2023/11/06</h3> <h3 id="事务特性"><a href="#事务特性" class="header-anchor">#</a> 事务特性?</h3> <p>ACID
原子,一致,隔离,持久</p> <h3 id="事务隔离级别有哪些"><a href="#事务隔离级别有哪些" class="header-anchor">#</a> 事务隔离级别有哪些?</h3> <p>RU(读未提交)
RC(读已提交)
RR(可重复读)(默认)
S(序列化)</p> <h3 id="不同隔离级别都有什么问题"><a href="#不同隔离级别都有什么问题" class="header-anchor">#</a> 不同隔离级别都有什么问题?</h3> <p>脏读:一个事务读取到了另一个事物修改但是没提交的记录
不可重复读:一个事务读取同一条数据但是前后两次数据不同
幻读:一个事务新增或删除的记录没有被另一个事务读取
慢</p> <h3 id="mvcc"><a href="#mvcc" class="header-anchor">#</a> MVCC</h3> <p>不可重复读:通过MVCC解决
多版本(一行数据的版本链)并发(场景)控制(读取的结果)</p> <p>版本链: undolog 和 mysql针对每行数据的隐藏字段trx_id和上个版本的指针</p> <p>read view:
min_id(最小事务):26                     :26
max_id(最大事务):全局的下一个事务id         :101
cur_trx_id(当前事务id)                   :100
active_id_list(当前活跃事务列表)           :26,38,75</p> <ol><li>比最小的小 一定读</li> <li>比最大的打 一定读</li> <li>当前事务id 肯定读</li> <li>看在不在活跃事务列表 在 不读//不在 读</li></ol> <p>隔离级别真正的区别不在于过滤的条件,而是在于生成的时机</p> <h3 id="幻读"><a href="#幻读" class="header-anchor">#</a> 幻读</h3> <p>两次查询数据量不一致
解决方案: 直接不让他插入
select for update next-key-lock间隙锁</p> <p>mysql解决了(快照读下的)幻读</p> <h3 id="快照读和当前读的区别"><a href="#快照读和当前读的区别" class="header-anchor">#</a> 快照读和当前读的区别</h3> <h2 id="mysql基础知识"><a href="#mysql基础知识" class="header-anchor">#</a> MySQL基础知识</h2> <h3 id="mysql的数据是如何存储在磁盘的-表到底是个什么概念"><a href="#mysql的数据是如何存储在磁盘的-表到底是个什么概念" class="header-anchor">#</a> Mysql的数据是如何存储在磁盘的,表到底是个什么概念?</h3> <p>Mysql中的每个数据库都存储为文件系统上的目录, 每个表存储为一个单独文件</p> <ul><li>逻辑上是表, 物理上是个什么东西?
<ul><li>物理上就是数据页16KB一页</li></ul></li> <li>行格式
<ul><li>按行记录数据的格式</li></ul></li> <li>行溢出
<ul><li>一个数据页上限是16k大小,大于这个值就是行溢出</li></ul></li> <li>数据页
<ul><li>一个数据页上限是16k大小</li></ul></li> <li>数据区
<ul><li>一张表的大小区域</li></ul></li></ul> <h3 id="一条更新sql的执行流程-还需要学习一下"><a href="#一条更新sql的执行流程-还需要学习一下" class="header-anchor">#</a> 一条更新sql的执行流程(还需要学习一下)</h3> <ol><li>先建立数据库连接, 然后经过sql解析器, sql优化器, 开始执行sql</li> <li>先把数据加载到缓存, 更新buffer pool, 然后更新undoLog(写入旧值便于回滚), 再进行事务的两阶段提交</li></ol> <h3 id="acid特性遗迹实现原理"><a href="#acid特性遗迹实现原理" class="header-anchor">#</a> ACID特性遗迹实现原理?</h3> <ul><li>原子性: 事务是不可分割的工作单元, 事务中的操作要么都发生, 要么都不发生. 一部分成功,一部分失败,这时候需要回滚到事务开启前的状态.
<ul><li>实现: 原子性一靠undo log回滚日志实现,每次对数据做修改或者删除插入的操作都会生成一条undo log来记录操作之前的状态, 使用rollback语句就能够将执行成功的语句效果撤销.回滚日志比数据持久化先到硬盘上.回滚是逆向操作</li></ul></li> <li>一致性: 事务前后数据完整性一直, 一般来说就是数据的逻辑一致性(比如A给B转账, 不管是否成功, 两者的存款总额不变)
<ul><li>实现: 依靠其他三个性质实现, 一致性指的是事务的完整性, 为了保证数据的有意义状态.</li></ul></li> <li>隔离性: 事务的隔离性是多个用户并发访问数据库时, 数据库为每一个用户开启的事务, 不能被其他事务的操作数据所干扰, 多个并发事务之间要互相隔离.
<ul><li>实现: 通过锁机制实现,当事务操作数据的时候加锁,让事务执行前后看到的数据是一致的,并行执行事务和串行执行事务产生的效果一样.另外就是利用MVCC实现的快照读</li></ul></li> <li>持久性: 持久性是指一个事务一旦被提交,它对数据库中数据的改变是永久的,接下来即使数据库发生故障也不应该对其有任何影响
<ul><li>实现: 持久性通过redo log重做日志实现, redo log记录的是对数据库的操作. MySQL先把存放在硬盘上的数据加载到内存中,在内存中做修改再刷回磁盘,redo log使得在事务提交的时候将数据刷回磁盘.</li></ul></li></ul> <h3 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h3> <p>索引的结构?</p> <p>B+树</p> <h6 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h6> <ul><li><p>矮胖</p> <ul><li><p>层级低,IO次数少</p></li> <li><p>叶子结点形成有序链表,范围查找方便</p></li> <li><p>矮: 减少IO, 树每往下翻一层都会进行一次磁盘IO</p></li> <li><p>胖: 数据都在叶子节点, 用双向链表连接, 支持范围查询</p></li></ul></li> <li><p>叶子节点存储所有数据</p> <ul><li>降低层高,意味着查询数据可以有效减少磁盘IO</li></ul></li> <li><p>叶子节点之间通过双向链表互相联结</p> <ul><li>便于互联网业务的范围查询,顺序查询</li></ul></li></ul> <p>索引的分类:</p> <ul><li>聚簇索引: 主键索引, 通过主键id维护索引树, 叶子节点上挂着所有数据</li> <li>普通索引: 基本索引类型, 没有什么限制, 允许在定义索引的列中插入重复值和空值, 纯粹为了查询数据更快一些</li> <li>联合索引: 遵循最左前缀匹配原则, 即最左优先, 查询的时候会优先匹配最左边的索引</li> <li>唯一索引: 索引列中的值必须是唯一的, 但是允许为空值</li></ul> <p>索引原理与SQL优化:</p> <ul><li><p>什么是索引覆盖?</p> <ul><li>索引覆盖是一个现象, 在联合索引中, 查询的数据正好是索引的字段, 就是索引覆盖</li></ul></li> <li><p>什么是回表?</p> <ul><li>回表是一个动作, 在联合索引中, 查询的数据不包含索引, 就根据联合索引叶子节点上的主键id, 在进行一次聚簇索引, 这个动作就是回表</li></ul></li> <li><p>什么是索引下推?</p> <ul><li>在联合索引中, 对索引包含的字段先进行判断, 过滤掉不符合条件的记录, 来减少回表的次数. 总的来说就是能用到索引就用索引, 用到了都比全表查询快</li></ul></li> <li><p>什么是索引跳跃?</p> <ul><li><p>8.0版本引入的优化, 在联合索引(a,b)中, 查询语句是where b=xx, 那么就会构造成where a=1 and b=xx union where a=2 and b=xx这样的语句来达到走索引的目的</p></li> <li><p>mysql只是提供了这个机制, 具体的执行会根据他自己的判断进行综合选择</p></li></ul></li> <li><p>什么是索引?</p> <ul><li>一组排好序的数据结构</li></ul></li> <li><p>索引失效的情况有几种?</p> <ul><li><p>第一, 查询从数据结构上根本走不了索引</p></li> <li><p>第二种, MySQL根据自己的判断觉得走不了索引, 就会进行全表扫描</p></li></ul></li> <li><p>慢SQL优化</p> <ul><li><p>EXPLAIN</p> <ul><li><p>using where 单纯指代使用了where条件过滤数据</p></li> <li><p>using index condition代表使用索引但是不彻底, 发生了回表</p></li> <li><p>using index 表示索引覆盖</p></li></ul></li> <li><p>数据库层面</p> <ul><li><p>索引的设计与取舍</p></li> <li><p>索引失效分析 看SQL走不了索引还是优化器自动判断</p></li> <li><p>碎片整理</p></li></ul></li> <li><p>代码层面</p> <ul><li><p>严禁for循环</p></li> <li><p>连接池参数优化 默认8个</p></li> <li><p>尽量避免联表查询, 都走单表查询性能最高</p></li></ul></li> <li><p>架构层面</p> <ul><li><p>单库有瓶颈 分库分表</p></li> <li><p>主从 读写分离(读从库必须是对业务实时性要求不严苛的业务)</p></li> <li><p>进一步搜索架构的延伸</p> <ul><li><p>es宽表</p></li> <li><p>hbase row-key结构的大数据组件</p></li></ul></li></ul></li></ul></li></ul> <h3 id="隔离级别"><a href="#隔离级别" class="header-anchor">#</a> 隔离级别</h3> <ul><li><p>读未提交</p> <ul><li>脏读: 读到了其他事物没提交的数据</li></ul></li> <li><p>读已提交</p> <ul><li>不可重复读: 一次事务中多次读取同一条数据, 读取的数据不一致</li></ul></li> <li><p>可重复读</p> <ul><li>幻读: 一次事务中相同的查询语句, 得到的数量不一致</li></ul></li> <li><p>序列化</p> <ul><li>慢: 所有事务串行执行</li></ul></li></ul> <h3 id="mysql的几种日志"><a href="#mysql的几种日志" class="header-anchor">#</a> MySQL的几种日志</h3> <ul><li><p>redoLog: 前滚日志</p></li> <li><p>undoLog: 回滚日志(版本链)</p></li> <li><p>binLog: 二进制日志, 基本记录所有数据的更改</p></li></ul> <h3 id="mvcc-多版本并发控制"><a href="#mvcc-多版本并发控制" class="header-anchor">#</a> MVCC(多版本并发控制)</h3> <ul><li><p>多版本: 版本链</p></li> <li><p>并发: 并发场景下多个线程对一行数据进行读写</p></li> <li><p>控制: 用版本链控制事务读取的结果是哪个版本的数据</p></li></ul> <h4 id="不同的隔离级别中生成read-view的策略不同"><a href="#不同的隔离级别中生成read-view的策略不同" class="header-anchor">#</a> 不同的隔离级别中生成read-view的策略不同</h4> <ul><li><p>读已提交: 每次执行查询sql时都会重新生成新的的read-view</p></li> <li><p>可重复读: 只有第一次查询会生成read-view, 后续都是读取第一次的快照</p></li></ul> <h4 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h4> <p>支持数据并发修改场景下的快照读</p> <h4 id="实现原理"><a href="#实现原理" class="header-anchor">#</a> 实现原理</h4> <ul><li><p>read-view和undoLog记录的数据进行匹配,对的上就去读undoLog记录的最新数据</p></li> <li><p>undoLog版本链: undoLog版本链是指一行数据被多个事务一次修改过后, 在每个事务修改完后,MySQL会保留修改前的数据到undo回滚日志,并且用trx_id(事务id)和roll_pointer(回滚日志)两个隐藏字段把这些undoLog串联起来形成一个历史记录版本链</p></li> <li><p>read-view: 4个标志位</p> <ul><li><p>min_id: 最小事务id</p></li> <li><p>max_id: 当前最大事务id+1</p></li> <li><p>cur_trx_id: 当前事务</p></li> <li><p>active_ids: 当前活跃事务列表</p></li></ul></li> <li><p>MVCC如何根据read-view结合行数据的undoLog版本链过滤数据?</p> <ul><li><p>按顺序比较</p> <ul><li><p>最新的undoLog记录的事务id比read-view中的min_trx_id小, 说明这条undoLog的事务在read-view产生的时候已经被提交了</p></li> <li><p>如果行数据的最新undoLog事务id和当前read-view的cur_trx_id一样,说明是这个事务的, 也可以读</p></li> <li><p>如果undoLog记录的事务id就在活跃列表中, 那也不能读, 因为活跃列表都是还没有提交的事务id</p></li> <li><p>如果行数据的最新undoLog比max_trx_id还大, 说明它是在这个事务之后提交的, 也不能读</p></li></ul></li> <li><p>按照顺序比较下来之后没有合适的, 那就按照undoLog版本链的上一个指针向上找, 重新进行比较, 直到找到一个符合规则的数据</p></li></ul></li></ul></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/handbook/JAVA/@SentinelResource不生效的问题.html" class="prev">
          @SentinelResource不生效的问题
        </a></span> <span class="next"><a href="/blog/handbook/中间件/Nacos.html">
          Nacos
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#_2023-11-06" class="sidebar-link reco-side-_2023-11-06" data-v-b57cc07c>2023/11/06</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#事务特性" class="sidebar-link reco-side-事务特性" data-v-b57cc07c>事务特性?</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#事务隔离级别有哪些" class="sidebar-link reco-side-事务隔离级别有哪些" data-v-b57cc07c>事务隔离级别有哪些?</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#不同隔离级别都有什么问题" class="sidebar-link reco-side-不同隔离级别都有什么问题" data-v-b57cc07c>不同隔离级别都有什么问题?</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#mvcc" class="sidebar-link reco-side-mvcc" data-v-b57cc07c>MVCC</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#幻读" class="sidebar-link reco-side-幻读" data-v-b57cc07c>幻读</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#快照读和当前读的区别" class="sidebar-link reco-side-快照读和当前读的区别" data-v-b57cc07c>快照读和当前读的区别</a></li><li class="level-2" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#mysql基础知识" class="sidebar-link reco-side-mysql基础知识" data-v-b57cc07c>MySQL基础知识</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#mysql的数据是如何存储在磁盘的-表到底是个什么概念" class="sidebar-link reco-side-mysql的数据是如何存储在磁盘的-表到底是个什么概念" data-v-b57cc07c>Mysql的数据是如何存储在磁盘的,表到底是个什么概念?</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#一条更新sql的执行流程-还需要学习一下" class="sidebar-link reco-side-一条更新sql的执行流程-还需要学习一下" data-v-b57cc07c>一条更新sql的执行流程(还需要学习一下)</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#acid特性遗迹实现原理" class="sidebar-link reco-side-acid特性遗迹实现原理" data-v-b57cc07c>ACID特性遗迹实现原理?</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#索引" class="sidebar-link reco-side-索引" data-v-b57cc07c>索引</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#隔离级别" class="sidebar-link reco-side-隔离级别" data-v-b57cc07c>隔离级别</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#mysql的几种日志" class="sidebar-link reco-side-mysql的几种日志" data-v-b57cc07c>MySQL的几种日志</a></li><li class="level-3" data-v-b57cc07c><a href="/blog/handbook/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL20231106.html#mvcc-多版本并发控制" class="sidebar-link reco-side-mvcc-多版本并发控制" data-v-b57cc07c>MVCC(多版本并发控制)</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/blog/assets/js/app.72825979.js" defer></script><script src="/blog/assets/js/7.8588c638.js" defer></script><script src="/blog/assets/js/2.41cf65d9.js" defer></script><script src="/blog/assets/js/1.934c718e.js" defer></script><script src="/blog/assets/js/48.fbf85be5.js" defer></script>
  </body>
</html>
